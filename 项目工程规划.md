# Reddit Signal Scanner — 项目执行蓝图（v1）

> 目标：把“从 Reddit 抓信号 → 去噪与结构化 → 生成可交易的洞察”做成稳定流水线，并形成可交付的洞察卡片与导出能力。

## 暂缓与约定
- [.env.local]：已记录，暂缓处理（不影响当前开发）。
- [Reddit TOS]：尊重合规，当前仅自用研究；合规专项在后续版本启动（见风险台账）。

## 版本目标
- **M0（1 周）**：把工程地雷清掉、跑通最小质量看板、上线“洞察卡片 v0（证据可展开）”。
- **M1（1 个月）**：NER v1（品牌/功能/痛点/价格/平台）、二级去重+主题聚类、导出（CSV/PPT/Notion），打通主动学习回路。
- **M2（1 季度）**：趋势分析 v1（新兴主题检测+强度曲线）、竞品雷达、成本优化与评测体系完善。

## 优先级定义
- **P0（现在就干）**：阻塞主路径/收益最高/风险最大。
- **P1（本月内）**：对增长或体验关键但不阻塞主路径。
- **P2（季度内）**：增强型能力与优化项。

## 角色与分工（RACI）
- **Tech Lead（TL）**：架构决策、性能与安全把关（R/A）。
- **Backend**：数据采集、管道、API（R）。
- **Data/ML**：去重/聚类、NER、趋势、评测（R）。
- **Frontend**：洞察卡片、看板、导出（R）。
- **PM**：需求优先级、验收标准、里程碑与节奏（A/C）。
- **Ops（运营/分析）**：数据源维护、标注与质检、周报与内测运营（R/C）。
- **QA**：测试策略与E2E质量（R）。

## 成功标准（高层 OKR）
- **O1 数据质量**：重复率 ≤ 8%，采集成功率 ≥ 98%，证据可读性评分 ≥ 4/5。
- **O2 洞察价值**：洞察审阅通过率 ≥ 70%，Top10 机会卡片每周可被复用于评审会。
- **O3 成本与效率**：单条洞察成本下降 30%，P95 端到端耗时 ≤ 5 分钟。

工程与算法任务清单（含验收）

# 工程 & 算法任务清单（按优先级）

## P0（1 周内）
1. 清理依赖目录（仓库瘦身）
   - 任务：移除根目录 `node_modules/`、`venv/`；更新 `.gitignore`；在 CI 启用依赖缓存。
   - 验收：`git log --stat` 不再出现这些目录；CI 安装时长下降 ≥ 40%；仓库体积下降显著。

2. 最小数据质量看板 v0
   - 任务：后端暴露 `/metrics` 或写入 `reports/daily_metrics.jsonl`；前端展示三项：采集成功率、重复率、处理耗时（P50/P95）。
   - 验收：可按日期过滤查看；新增数据后 5 分钟内指标刷新。

3. 洞察卡片 v0（含证据折叠）
   - 任务：统一卡片数据结构：{标题、摘要、置信度、时间窗、子版块、证据段落列表（原帖链接+摘录+时间）}
   - 验收：前端可分页浏览；点击展开能看到原帖片段；后端接口 `GET /insights` 返回固定 schema。

4. 去重二级化（文本近似 + 主题聚合）
   - 任务：在现有去重基础上加入 MinHash/SimHash（近似文本）、再加一次主题聚类（HDBSCAN 或 KMeans+轮廓系数评估）。
   - 验收：重复率指标下降 ≥ 30%；人工抽检 50 条主题簇，纯度 ≥ 0.75。

5. E2E 冒烟用例收敛
   - 任务：只保留关键路径 E2E（抓取 → 处理 → 生成卡片 → 前端展示）。
   - 验收：`make test-e2e` ≤ 5 分钟通过，失败快照自动入 `reports/failed_e2e/`。

## P1（1 个月内）
6. NER v1（实体抽取）
   - 任务：抽取实体：品牌、功能、痛点、价格、平台/设备、场景；采用“规则/词典+小模型”混合。
   - 验收：标注集上 F1 ≥ 0.75；实体在卡片中以高亮标签渲染；支持实体筛选。

7. 主动学习闭环
   - 任务：模型置信度<阈值样本进入“待标注池”，Ops 标注后自动回灌。
   - 验收：每周新增≥200 条带标注样本；回灌后 F1 提升或稳定（不退化）。

8. 导出能力（CSV / PPT / Notion）
   - 任务：后端生成 CSV；PPT 使用模板化导出（标题、要点、证据）；Notion 通过 API 写入数据库。
   - 验收：三种导出都有按钮；导出的字段与卡片字段一一对应；PPT 模板可被评审会直接使用。

9. 质量看板 v1（可配置）
   - 任务：指标扩展：语言占比、主题漂移（JS 散度）、实体召回曲线、单条洞察成本。
   - 验收：前端可选择指标和时间窗；每日报表自动产出并存档。

10. API 契约与类型安全
    - 任务：后端启用严格 `response_model`；生成 OpenAPI；前端用 `openapi-typescript` 生成 SDK。
    - 验收：前端无手写接口类型；接口字段拼写错误在编译期即失败。

## P2（季度内）
11. 趋势分析 v1
    - 任务：基于时序聚类与突发检测（e.g. EARS/阈值+滑窗）输出“新兴主题”和强度曲线。
    - 验收：趋势卡片包含：主题名、增长率、峰值时间、代表证据；与历史对比可视化。

12. 竞品雷达
    - 任务：围绕品牌/功能/口碑/价格生成雷达图；支持多社区对比。
    - 验收：任选四品牌生成可视化；导出到 PPT 的图表可编辑。

13. 成本与缓存
    - 任务：Embedding 与生成式调用加缓存；重复请求命中率≥60%。
    - 验收：单位洞察成本下降≥30%，同时质量不退化。

## Definition of Done（DoD）
- 代码：单元测试覆盖关键逻辑；类型检查通过；Lint 清洁。
- 文档：接口与使用说明更新；Changelog 补全。
- 可观测性：关键指标有采集与告警；回滚路径明确。

指标与看板规范（给前后端对齐）

# 指标与看板规范（v1）

## 数据质量
- 采集成功率 = 成功抓取条数 / 请求条数
- 重复率 = 被去重的条数 / 原始条数
- 语言占比 = 各语种条数 / 总条数
- 主题漂移 = JS散度（T-1周 vs T周 的主题分布）

## 模型质量
- NER F1（宏平均）
- 聚类纯度（人工 50 样本）
- 洞察审阅通过率（Ops 抽检打分 ≥3/5 视为通过）
- 证据可读性评分（1–5，定义在评分表）

## 性能与成本
- 端到端延迟（P50/P95）
- 单条洞察成本（模型/Embedding/抓取合计）
- 缓存命中率（模型调用）

## 前端看板要求
- 可选时间窗（日/周/月）
- 指标卡+趋势图（线图）
- 导出 PNG/SVG
- 切换后 2s 内完成渲染

## 数据落地
- `reports/daily_metrics.jsonl`：按天一行
- `reports/weekly_summary.md`：周报自动生成

测试策略与验收清单

# 测试策略（v1）

## 金字塔
- 单元测试：文本处理、去重哈希、聚类评估、NER 规则。
- 集成测试：采集→处理→存储；API→前端渲染（合成数据）。
- E2E：关键路径 3 条以内。

## 验收（抽样+自动化）
- 抽样 50 条卡片：证据与摘要一致率 ≥ 90%。
- 链接可达率 ≥ 98%。
- NER 实体验收：误标明显错不超过 10/200。

GitHub Issue 模板（直接可用）.github/ISSUE_TEMPLATE/feature_request.

---
name: Feature request
about: 功能需求
labels: ["type:feature"]
---

## 背景
（为什么需要？业务影响？）

## 需求
- [ ] 功能点1
- [ ] 功能点2

## 验收标准
- [ ] 指标/UI/接口明确
- [ ] 文档与示例

.github/ISSUE_TEMPLATE/bug_report.

---
name: Bug report
about: 缺陷反馈
labels: ["type:bug"]
---

## 现象
## 期望
## 复现步骤
## 截图/日志
## 影响范围

.github/PULL_REQUEST_TEMPLATE.

## 改动
## 关联 Issue
## 自测清单
- [ ] 单测通过
- [ ] 类型检查通过
- [ ] 文档更新

建议的 Issue 列表（可直接创建）ISSUES_BACKLOG

# 建议创建的 Issues（按优先级）

## P0
- chore: 仓库瘦身与依赖缓存（移除 node_modules/venv，更新 .gitignore）
- feat: 数据质量看板 v0（采集成功率/重复率/耗时）
- feat: 洞察卡片 v0（证据折叠与链接）
- feat: 去重二级化（MinHash/SimHash + 主题聚类）
- test: E2E 冒烟收敛与失败快照归档
- docs: 洞察卡片字段字典 v1 与导出模板 v0

## P1
- feat: NER v1（品牌/功能/痛点/价格/平台/场景）
- feat: 主动学习闭环（低置信度样本池 → 标注 → 回灌）
- feat: 导出能力（CSV/PPT/Notion）
- feat: 质量看板 v1（语言占比、主题漂移、实体召回、成本）
- feat: API 契约化 & 前端 SDK 自动生成
- chore: 指标落盘归档（daily_metrics.jsonl / weekly_summary.md）

## P2
- feat: 趋势分析 v1（新兴主题+强度曲线）
- feat: 竞品雷达（品牌/功能/口碑/价格）
- perf: 模型调用缓存与成本优化
- docs: 趋势报告模板 v1

风险台账（包含你要求的“记录即可”项

# 风险台账

| 风险 | 等级 | 状态 | 说明/缓解 |
|---|---|---|---|
| 依赖目录入库导致仓库膨胀 | 高 | 处理中 | 已纳入 P0：移除 node_modules/venv，CI 缓存 |
| .env.local 入库 | 中 | 暂缓 | 已记录，按产品方要求暂不处理；如出现敏感值需立即更换 |
| Reddit TOS 合规 | 中 | 暂缓 | 当前自用研究；后续启动合规清单（速率限制、缓存时长、退订机制） |
| 模型成本漂移 | 中 | 持续 | 引入缓存与复用，跟踪单条洞察成本 |
| 证据失真/误解 | 高 | 持续 | 强制证据链展示与人工抽检 |

创建上面这些文件，合并到 docs/；
	•	创建 ISSUES_BACKLOG.md 中列出的 P0 Issues
小小提醒：别把仓库当网盘（node_modules/、venv/马上清），其余两项（.env.local 与 TOS）我已按你说的“记录，但暂不处理”