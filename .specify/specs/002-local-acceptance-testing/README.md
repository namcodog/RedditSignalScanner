# æœ¬åœ°æµ‹è¯•ç¯å¢ƒéªŒæ”¶ - å¿«é€Ÿå¼€å§‹

**Feature ID**: 002-local-acceptance-testing  
**çŠ¶æ€**: READY  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-16

---

## ğŸ“‹ æ¦‚è¿°

æœ¬éªŒæ”¶æ–¹æ¡ˆä¸º Day 13-20 é¢„çƒ­æœŸåŠŸèƒ½æä¾›**å®Œå…¨éš”ç¦»çš„æœ¬åœ°æµ‹è¯•ç¯å¢ƒ**ï¼Œç¡®ä¿ï¼š
- âœ… æµ‹è¯•ç¯å¢ƒä¸å¼€å‘ç¯å¢ƒå®Œå…¨éš”ç¦»ï¼ˆç‹¬ç«‹ç«¯å£ã€ç‹¬ç«‹æ•°æ®åº“ã€ç‹¬ç«‹ Docker ç½‘ç»œï¼‰
- âœ… æ‰€æœ‰æœåŠ¡é€šè¿‡ Docker Compose ç»Ÿä¸€ç®¡ç†ï¼Œä¸€é”®å¯åŠ¨/åœæ­¢
- âœ… è‡ªåŠ¨åŒ–éªŒæ”¶æµç¨‹ï¼Œé€šè¿‡ Makefile å‘½ä»¤æ‰§è¡Œ
- âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–ï¼ˆç¯å¢ƒå‡†å¤‡ â†’ æ ¸å¿ƒæœåŠ¡ â†’ API â†’ ä»»åŠ¡è°ƒåº¦ â†’ ç«¯åˆ°ç«¯ï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‰ç½®å‡†å¤‡ï¼ˆå¿…é¡»å®Œæˆï¼‰

**é‡è¦**: æœ¬éªŒæ”¶ä½¿ç”¨**çœŸå® Reddit API**ï¼Œéœ€è¦å…ˆé…ç½®å‡­è¯

```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /Users/hujia/Desktop/RedditSignalScanner

# è¿è¡Œå‰ç½®å‡†å¤‡è„šæœ¬ï¼ˆè‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒï¼‰
bash scripts/setup-test-env.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
- âœ… æ£€æŸ¥ Reddit API å‡­è¯ï¼ˆ`.env` æ–‡ä»¶ï¼‰
- âœ… åˆ›å»ºæµ‹è¯•æ•°æ®æ–‡ä»¶ï¼ˆ10 ä¸ªç¤¾åŒºï¼‰
- âœ… éªŒè¯ Docker ç¯å¢ƒ
- âœ… æ£€æŸ¥ç«¯å£å¯ç”¨æ€§
- âœ… éªŒè¯ Docker Compose é…ç½®

**å¦‚æœè„šæœ¬æç¤ºç¼ºå°‘ Reddit API å‡­è¯**ï¼š
1. è®¿é—® https://www.reddit.com/prefs/apps
2. åˆ›å»ºåº”ç”¨ï¼ˆç±»å‹é€‰æ‹© `script`ï¼‰
3. å¤åˆ¶ `client_id` å’Œ `client_secret`
4. ç¼–è¾‘é¡¹ç›®æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶ï¼š
   ```bash
   REDDIT_CLIENT_ID=your_actual_client_id
   REDDIT_CLIENT_SECRET=your_actual_client_secret
   REDDIT_USER_AGENT=RedditSignalScanner/Test:v1.0
   ```
5. é‡æ–°è¿è¡Œ `bash scripts/setup-test-env.sh`

---

### 2. ä¸€é”®æ‰§è¡Œå®Œæ•´éªŒæ”¶

```bash
# æ‰§è¡Œå®Œæ•´éªŒæ”¶æµç¨‹ï¼ˆçº¦ 15-20 åˆ†é’Ÿï¼‰
# æ³¨æ„ï¼šä¼šè°ƒç”¨çœŸå® Reddit APIï¼ˆçº¦ 10-15 æ¬¡è¯·æ±‚ï¼‰
make test-all-acceptance
```

---

### 3. åˆ†æ­¥æ‰§è¡Œï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰

```bash
# Step 1: å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
make test-env-up

# Step 2: Stage 1 - ç¯å¢ƒå‡†å¤‡ä¸å¥åº·æ£€æŸ¥
make test-stage-1

# Step 3: Stage 2 - æ ¸å¿ƒæœåŠ¡éªŒæ”¶ï¼ˆä¼šè°ƒç”¨çœŸå® Reddit APIï¼‰
make test-stage-2

# Step 4: Stage 3 - API ç«¯ç‚¹éªŒæ”¶
make test-stage-3

# Step 5: Stage 4 - ä»»åŠ¡è°ƒåº¦ä¸ç›‘æ§
make test-stage-4

# Step 6: Stage 5 - ç«¯åˆ°ç«¯æµç¨‹
make test-stage-5

# Step 7: ç”ŸæˆéªŒæ”¶æŠ¥å‘Š
make test-report-acceptance

# Step 8: åœæ­¢å¹¶æ¸…ç†ç¯å¢ƒ
make test-env-clean
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
RedditSignalScanner/
â”œâ”€â”€ docker-compose.test.yml          # æµ‹è¯•ç¯å¢ƒ Docker Compose é…ç½®
â”œâ”€â”€ Makefile                          # è‡ªåŠ¨åŒ–å‘½ä»¤ï¼ˆå·²è¿½åŠ æµ‹è¯•å‘½ä»¤ï¼‰
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Dockerfile.test               # æµ‹è¯•ç¯å¢ƒ Dockerfile
â”‚   â”œâ”€â”€ pytest.ini                    # Pytest é…ç½®
â”‚   â””â”€â”€ tests/                        # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ .specify/specs/002-local-acceptance-testing/
â”‚   â”œâ”€â”€ README.md                     # æœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ plan.md                       # è¯¦ç»†éªŒæ”¶è®¡åˆ’
â”‚   â””â”€â”€ tasks.md                      # ä»»åŠ¡æ¸…å•
â””â”€â”€ reports/
    â””â”€â”€ acceptance-test-report.md     # éªŒæ”¶æŠ¥å‘Šï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
```

---

## ğŸ”§ å¯ç”¨å‘½ä»¤

### ç¯å¢ƒç®¡ç†

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `make test-env-up` | å¯åŠ¨æµ‹è¯•ç¯å¢ƒï¼ˆDocker Composeï¼‰ |
| `make test-env-down` | åœæ­¢æµ‹è¯•ç¯å¢ƒ |
| `make test-env-clean` | æ¸…ç†æµ‹è¯•ç¯å¢ƒï¼ˆåˆ é™¤å·ï¼‰ |
| `make test-env-logs` | æŸ¥çœ‹æµ‹è¯•ç¯å¢ƒæ—¥å¿— |
| `make test-env-shell` | è¿›å…¥æµ‹è¯•å®¹å™¨ Shell |

### éªŒæ”¶æµç¨‹

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `make test-all-acceptance` | æ‰§è¡Œå®Œæ•´éªŒæ”¶æµç¨‹ï¼ˆStage 1-5ï¼‰ |
| `make test-stage-1` | Stage 1: ç¯å¢ƒå‡†å¤‡ä¸å¥åº·æ£€æŸ¥ |
| `make test-stage-2` | Stage 2: æ ¸å¿ƒæœåŠ¡éªŒæ”¶ |
| `make test-stage-3` | Stage 3: API ç«¯ç‚¹éªŒæ”¶ |
| `make test-stage-4` | Stage 4: ä»»åŠ¡è°ƒåº¦ä¸ç›‘æ§ |
| `make test-stage-5` | Stage 5: ç«¯åˆ°ç«¯æµç¨‹ |
| `make test-report-acceptance` | ç”ŸæˆéªŒæ”¶æŠ¥å‘Š |

---

## ğŸŒ æœåŠ¡åœ°å€

| æœåŠ¡ | å¼€å‘ç¯å¢ƒ | æµ‹è¯•ç¯å¢ƒ | è¯´æ˜ |
|------|----------|----------|------|
| FastAPI | http://localhost:8000 | http://localhost:18000 | API æœåŠ¡å™¨ |
| PostgreSQL | localhost:5432 | localhost:15432 | æ•°æ®åº“ |
| Redis | localhost:6379 | localhost:16379 | ç¼“å­˜ |

**ç«¯å£è§„èŒƒ**ï¼šæµ‹è¯•ç¯å¢ƒç«¯å£ = å¼€å‘ç¯å¢ƒç«¯å£ + 10000ï¼ˆé¿å…å†²çªï¼‰

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§

- [x] æ‰€æœ‰ 10 ä¸ª Phase çš„åŠŸèƒ½å¯ç”¨
- [x] æ‰€æœ‰ API ç«¯ç‚¹è¿”å›æ­£ç¡®å“åº”
- [x] æ‰€æœ‰ Celery ä»»åŠ¡å¯æ‰§è¡Œ
- [x] æ‰€æœ‰æ•°æ®åº“è¡¨æœ‰æ­£ç¡®æ•°æ®

### æ•°æ®ä¸€è‡´æ€§

- [x] Redis ç¼“å­˜ä¸ PostgreSQL å…ƒæ•°æ®ä¸€è‡´
- [x] ç¤¾åŒºå‘ç°è®°å½•å¯è¿½æº¯åˆ°ä»»åŠ¡
- [x] Beta åé¦ˆå…³è”åˆ°æ­£ç¡®çš„ä»»åŠ¡å’Œç”¨æˆ·

### æ€§èƒ½è¾¾æ ‡

- [x] æ‰€æœ‰æ€§èƒ½åŸºå‡†è¾¾æ ‡
- [x] æ— å†…å­˜æ³„æ¼ï¼ˆè¿è¡Œ 1 å°æ—¶åæ£€æŸ¥ï¼‰
- [x] æ— æ•°æ®åº“è¿æ¥æ³„æ¼

### ç¯å¢ƒéš”ç¦»

- [x] æµ‹è¯•ç¯å¢ƒä¸å¼€å‘ç¯å¢ƒç«¯å£ä¸å†²çª
- [x] æµ‹è¯•æ•°æ®ä¸æ±¡æŸ“å¼€å‘æ•°æ®åº“
- [x] Docker å·å¯å®Œå…¨æ¸…ç†

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: Docker Compose å¯åŠ¨å¤±è´¥

```bash
# æ£€æŸ¥ Docker æœåŠ¡
docker info

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :18000
lsof -i :15432
lsof -i :16379

# æ¸…ç†å¹¶é‡è¯•
make test-env-clean
make test-env-up
```

### é—®é¢˜ 2: æ•°æ®åº“è¿ç§»å¤±è´¥

```bash
# è¿›å…¥å®¹å™¨æ‰‹åŠ¨æ‰§è¡Œ
docker compose -f docker-compose.test.yml exec test-api bash
alembic upgrade head
alembic current
```

### é—®é¢˜ 3: æµ‹è¯•å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker compose -f docker-compose.test.yml logs test-api
docker compose -f docker-compose.test.yml logs test-worker

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker compose -f docker-compose.test.yml exec test-api bash
pytest tests/ -vv --tb=short
```

---

## ğŸ“Š æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | é¢„è®¡è€—æ—¶ | è¯´æ˜ |
|------|----------|------|
| ç¯å¢ƒå‡†å¤‡ | 5 åˆ†é’Ÿ | Docker é•œåƒæ‹‰å–ä¸æ„å»º |
| Stage 1 | 2 åˆ†é’Ÿ | å¥åº·æ£€æŸ¥ä¸æ•°æ®æ¸…ç† |
| Stage 2 | 5 åˆ†é’Ÿ | æ ¸å¿ƒæœåŠ¡å•å…ƒæµ‹è¯• |
| Stage 3 | 3 åˆ†é’Ÿ | API é›†æˆæµ‹è¯• |
| Stage 4 | 4 åˆ†é’Ÿ | ä»»åŠ¡è°ƒåº¦ä¸ç›‘æ§ |
| Stage 5 | 6 åˆ†é’Ÿ | ç«¯åˆ°ç«¯æµç¨‹ |
| æŠ¥å‘Šç”Ÿæˆ | 1 åˆ†é’Ÿ | ç”ŸæˆéªŒæ”¶æŠ¥å‘Š |
| **æ€»è®¡** | **26 åˆ†é’Ÿ** | é¦–æ¬¡æ‰§è¡Œï¼ˆå«é•œåƒæ„å»ºï¼‰ |
| **åç»­æ‰§è¡Œ** | **15 åˆ†é’Ÿ** | é•œåƒå·²ç¼“å­˜ |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¯¦ç»†éªŒæ”¶è®¡åˆ’](./plan.md) - å®Œæ•´çš„éªŒæ”¶æµç¨‹ä¸æŠ€æœ¯è§„èŒƒ
- [ä»»åŠ¡æ¸…å•](./tasks.md) - åˆ†é˜¶æ®µä»»åŠ¡æ‹†è§£
- [PRD-09 Day 13-20 é¢„çƒ­æœŸ](../ 001-day13-20-warmup-period/plan.md) - åŠŸèƒ½éœ€æ±‚æ–‡æ¡£

---

## ğŸ¯ ä¸‹ä¸€æ­¥

éªŒæ”¶é€šè¿‡åï¼Œå¯ä»¥ï¼š
1. è¡¥å…… Alembic è¿ç§»ï¼ˆPhase 9 æ–°å¢çš„ beta_feedback è¡¨ç­‰ï¼‰
2. é…ç½®ç”Ÿäº§ç¯å¢ƒçš„ Docker Compose
3. å‡†å¤‡ç”Ÿäº§éƒ¨ç½²æ–‡æ¡£ä¸è¿ç»´æ‰‹å†Œ
4. æ‰§è¡Œç”Ÿäº§ç¯å¢ƒå†’çƒŸæµ‹è¯•

---

**åˆ›å»ºæ—¥æœŸ**: 2025-10-16  
**æœ€åæ›´æ–°**: 2025-10-16  
**ç»´æŠ¤è€…**: Lead

