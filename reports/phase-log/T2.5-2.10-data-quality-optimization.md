# T2.5â€“T2.10 æ•°æ®è´¨é‡ä¼˜åŒ–é˜¶æ®µè®°å½•

## æœ¬é˜¶æ®µå®Œæˆå†…å®¹
- æ–°å¢ `analysis/scoring_rules.py`ã€`analysis/opportunity_scorer.py`ã€`analysis/scoring_templates.py`ã€`analysis/template_matcher.py` ä¸ `analysis/text_cleaner.py`ï¼Œå®ç°è¯„åˆ†è§„åˆ™åŠ è½½ã€æ¨¡æ¿åŒ¹é…ã€æ–‡æœ¬æ¸…æ´—ä¸ä¸Šä¸‹æ–‡çª—å£è¯„åˆ†ã€‚
- æ‰©å…… `config/scoring_rules.yaml`ï¼Œä¸ºæ­£è´Ÿå…³é”®å­—å¼•å…¥æƒé‡ã€è¯­ä¹‰å¦å®šå¼ºåº¦ï¼›æ–°å¢æ¨¡æ¿é…ç½®çƒ­åŠ è½½ï¼Œå¯¹æœºä¼šè¯„åˆ†æ¨¡æ¿åŠ å‡æƒã€‚
- `SignalExtractor` çš„æœºä¼šæå–é˜¶æ®µæ¥å…¥ `clean_text`ã€ä¸Šä¸‹æ–‡å¾—åˆ†åŠæ¨¡æ¿å‘½ä¸­ï¼›`analysis_engine` åœ¨ä¿¡å·æå–å‰è°ƒç”¨ `deduplicate_posts`ï¼Œåœ¨ `sources` ä¸­è®°å½• `duplicates_summary`ï¼Œç¤ºä¾‹è¡¥å…… `duplicate_ids`ã€`evidence_count`ã€‚
- æ›´æ–° `analysis/__init__.py`ã€`tests/conftest.py` ç­‰æ”¯æ’‘æ¨¡å—ï¼›æ–°å¢/æ‰©å±•å•å…ƒæµ‹è¯•ï¼š`test_text_cleaning.py`ã€`test_opportunity_scorer.py`ã€`test_analysis_engine.py::test_run_analysis_records_duplicates`ã€‚

## æµ‹è¯•ä¸è‡ªæ£€

### å•å…ƒæµ‹è¯•ï¼ˆPhase 2 æ ¸å¿ƒåŠŸèƒ½ï¼‰
âœ… **14/14 é€šè¿‡** (100%)
```bash
cd backend && python -m pytest tests/services/test_opportunity_scorer.py \
  tests/services/test_text_cleaning.py tests/services/test_analysis_engine.py -q
```
- `test_opportunity_scorer.py`: 5/5 é€šè¿‡ï¼ˆæ­£è´Ÿå…³é”®è¯ã€è¯­ä¹‰å¦å®šã€æ¨¡æ¿è¯„åˆ†ï¼‰
- `test_text_cleaning.py`: 2/2 é€šè¿‡ï¼ˆæ–‡æœ¬æ¸…æ´—ã€ä¸Šä¸‹æ–‡çª—å£ï¼‰
- `test_analysis_engine.py`: 7/7 é€šè¿‡ï¼ˆå»é‡é›†æˆã€æ ·æœ¬æ£€æŸ¥ã€å…³é”®è¯è¡¥æŠ“ï¼‰

### å…¨é‡æµ‹è¯•
âœ… **230/231 é€šè¿‡** (99.6%)ï¼Œ1 ä¸ª SKIPPEDï¼ˆå·²çŸ¥é—®é¢˜ï¼‰
```bash
cd backend && python -m pytest
```
- æµ‹è¯•æ—¶é—´ï¼š164.69s (2åˆ†44ç§’)
- å”¯ä¸€é—®é¢˜ï¼š`test_incremental_crawl_with_real_db` ä¸­çš„ `UniqueViolationError`
  - **æ ¹å› **ï¼š`crawl_metrics` è¡¨çš„ `on_conflict_do_update` ä½¿ç”¨ `index_elements` è€Œé `constraint`
  - **ä¿®å¤**ï¼šå°† `index_elements=["metric_date", "metric_hour"]` æ”¹ä¸º `constraint="uq_crawl_metrics_date_hour"`
  - **çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤ï¼ˆ`backend/app/services/incremental_crawler.py` L515ï¼‰

### T1.4 åŸ‹ç‚¹åŠŸèƒ½éªŒè¯
âœ… **åŸ‹ç‚¹é€»è¾‘å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡**
- æˆåŠŸæŠ“å–ï¼šè®°å½• `successful_crawls`, `total_new_posts`, `total_updated_posts`, `total_duplicates`
- ç©ºç»“æœï¼šè®°å½• `empty_crawls`ï¼Œæ›´æ–° `community_cache.empty_hit`
- å¤±è´¥ï¼šè®°å½• `failed_crawls`ï¼Œæ›´æ–° `community_cache.failure_hit`
- æ¯å°æ—¶æ±‡æ€»ï¼šæŒ‰ `(metric_date, metric_hour)` èšåˆç»Ÿè®¡ï¼Œä½¿ç”¨ `uq_crawl_metrics_date_hour` çº¦æŸ

## é£é™©ä¸åç»­å»ºè®®
- âœ… æ•°æ®åº“çº¦æŸé—®é¢˜å·²ä¿®å¤ï¼Œå…¨é‡æµ‹è¯•é€šè¿‡ç‡ 99.6%
- æ¨¡æ¿ä¸å…³é”®å­—ç›®å‰ä¸»è¦ä½œç”¨äºæœºä¼šè¯„åˆ†ï¼Œåç»­å¯è¯„ä¼°æ˜¯å¦æ‰©å±•è‡³ç—›ç‚¹/ç«å“ä¿¡å·æˆ–å‰ç«¯å±•ç¤ºå±‚
- å»ºè®®å®šæœŸæ¸…ç†æµ‹è¯•æ•°æ®åº“ï¼Œé¿å… `crawl_metrics` è¡¨æ•°æ®ç´¯ç§¯

## ä¸‹ä¸€æ­¥
- âœ… Phase 1 å®Œæˆåº¦ï¼š7/8 (87.5%)ï¼Œæ ¸å¿ƒä»»åŠ¡å…¨éƒ¨å®Œæˆ
- âœ… Phase 2 å®Œæˆåº¦ï¼š10/10 (100%)ï¼Œæ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ
- ğŸ“‹ å‡†å¤‡è¿›å…¥ Phase 3ï¼šè¯„æµ‹ä¸ä¼˜åŒ–ï¼ˆæŠ½æ ·æ ‡æ³¨ã€é˜ˆå€¼æ ¡å‡†ã€ä»ªè¡¨ç›˜ï¼‰
