# Day 11 执行计划

> **日期**: 2025-10-15  
> **目标**: 前端测试覆盖率 >70% + UI优化  
> **当前覆盖率**: 55.79%  
> **目标覆盖率**: >70%

---

## 📊 当前覆盖率分析

### 总体覆盖率
- **Statements**: 55.79%
- **Branches**: 70.45%
- **Functions**: 40%
- **Lines**: 55.79%

### 需要补充测试的文件（优先级排序）

#### 🔴 P0 - 0%覆盖率（必须补充）
1. **ProgressPage.tsx** (0%) - 532行
   - 核心页面，用户体验关键
   - 包含SSE连接、进度显示、错误处理
   - 预计提升覆盖率: +15%

2. **AdminDashboardPage.tsx** (0%) - 358行
   - Day 10新增页面
   - 包含Tab导航、表格、筛选
   - 预计提升覆盖率: +10%

3. **admin.service.ts** (0%) - 172行
   - Day 10新增服务
   - 7个API方法
   - 预计提升覆盖率: +5%

4. **useSSE.ts** (0%) - 266行
   - SSE连接核心Hook
   - 包含连接管理、错误处理、重连
   - 预计提升覆盖率: +8%

#### 🟡 P1 - 低覆盖率（建议补充）
5. **sse.client.ts** (32.6%)
   - SSE客户端实现
   - 预计提升覆盖率: +3%

6. **auth.api.ts** (73.94%)
   - 认证API，部分未覆盖
   - 预计提升覆盖率: +2%

7. **client.ts** (72.13%)
   - HTTP客户端，部分未覆盖
   - 预计提升覆盖率: +2%

#### 🟢 P2 - 已有较好覆盖（可选）
- InputPage.tsx (92.83%) ✅
- ReportPage.tsx (88.61%) ✅
- Components (96.58%) ✅
- Utils (100%) ✅

---

## 🎯 执行计划

### 阶段1: 补充ProgressPage测试（2小时）

**目标**: ProgressPage覆盖率 >80%

**测试文件**: `frontend/src/pages/__tests__/ProgressPage.test.tsx`

**测试用例**:
1. ✅ 应该显示加载状态
2. ✅ 应该建立SSE连接
3. ✅ 应该显示进度更新
4. ✅ 应该处理任务完成
5. ✅ 应该处理错误状态
6. ✅ 应该显示取消按钮
7. ✅ 应该处理取消操作
8. ✅ 应该在完成后跳转到报告页

**预计提升**: +15%

---

### 阶段2: 补充AdminDashboard测试（1.5小时）

**目标**: AdminDashboardPage覆盖率 >80%

**测试文件**: `frontend/src/pages/__tests__/AdminDashboardPage.test.tsx`

**测试用例**:
1. ✅ 应该显示页面标题
2. ✅ 应该显示系统状态
3. ✅ 应该显示Tab导航
4. ✅ 应该切换Tab
5. ✅ 应该显示社区列表
6. ✅ 应该支持搜索
7. ✅ 应该支持筛选
8. ✅ 应该显示功能按钮

**预计提升**: +10%

---

### 阶段3: 补充admin.service测试（1小时）

**目标**: admin.service覆盖率 >90%

**测试文件**: `frontend/src/services/__tests__/admin.service.test.ts`

**测试用例**:
1. ✅ getCommunities - 应该获取社区列表
2. ✅ recordCommunityDecision - 应该记录社区决策
3. ✅ generatePatch - 应该生成配置补丁
4. ✅ getAnalysisTasks - 应该获取分析任务列表
5. ✅ recordAnalysisFeedback - 应该记录分析反馈
6. ✅ getFeedbackSummary - 应该获取反馈汇总
7. ✅ getSystemStatus - 应该获取系统状态

**预计提升**: +5%

---

### 阶段4: 补充useSSE测试（1.5小时）

**目标**: useSSE覆盖率 >70%

**测试文件**: `frontend/src/hooks/__tests__/useSSE.test.ts`

**测试用例**:
1. ✅ 应该建立SSE连接
2. ✅ 应该接收消息
3. ✅ 应该处理错误
4. ✅ 应该自动重连
5. ✅ 应该在卸载时关闭连接
6. ✅ 应该处理连接超时

**预计提升**: +8%

---

### 阶段5: UI优化（1小时）

**目标**: 改善用户体验

**优化项**:
1. ✅ 加载状态优化
   - 骨架屏（Skeleton）
   - 加载动画
   - 进度指示器

2. ✅ 错误提示优化
   - 友好的错误消息
   - 错误恢复建议
   - 重试按钮

3. ✅ 响应式布局优化
   - 移动端适配
   - 平板适配
   - 桌面端优化

---

## 📈 预期覆盖率提升

| 阶段 | 文件 | 当前覆盖率 | 目标覆盖率 | 提升 |
|------|------|-----------|-----------|------|
| 1 | ProgressPage | 0% | 80% | +15% |
| 2 | AdminDashboard | 0% | 80% | +10% |
| 3 | admin.service | 0% | 90% | +5% |
| 4 | useSSE | 0% | 70% | +8% |
| 5 | 其他优化 | - | - | +2% |
| **总计** | **All files** | **55.79%** | **>70%** | **+40%** |

---

## ✅ 验收标准

### 测试覆盖率
- ✅ 总体覆盖率 >70%
- ✅ ProgressPage >80%
- ✅ AdminDashboard >80%
- ✅ admin.service >90%
- ✅ useSSE >70%

### 代码质量
- ✅ TypeScript: 0错误
- ✅ 所有测试通过
- ✅ 无console.error

### UI优化
- ✅ 加载状态优化完成
- ✅ 错误提示优化完成
- ✅ 响应式布局优化完成

---

## 🚀 执行时间表

| 时间 | 任务 | 负责人 | 状态 |
|------|------|--------|------|
| 09:00-11:00 | 补充ProgressPage测试 | Frontend | ⏳ |
| 11:00-12:30 | 补充AdminDashboard测试 | Frontend | ⏳ |
| 13:30-14:30 | 补充admin.service测试 | Frontend | ⏳ |
| 14:30-16:00 | 补充useSSE测试 | Frontend | ⏳ |
| 16:00-17:00 | UI优化 | Frontend | ⏳ |
| 17:00-17:30 | 验收和报告 | QA | ⏳ |

**总计**: 7小时

---

## 📝 注意事项

1. **测试优先级**: 先补充P0（0%覆盖率）的文件
2. **测试质量**: 不仅要覆盖率，还要测试质量
3. **UI优化**: 在不影响功能的前提下优化
4. **持续验证**: 每完成一个阶段就运行覆盖率检查
5. **文档更新**: 及时更新测试文档

---

**准备开始Day 11任务！** 🚀

