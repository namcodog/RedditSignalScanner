# Spec 007: MVP 产品闭环补全 - 完整计划

**生成日期**: 2025-10-27  
**代号**: 007-mvp-product-loop  
**优先级**: P0 - 马上能用起来，本地稳固正常跑  
**时间线**: 2 周（Week 1: P0, Week 2: P1）

---

## 📋 执行摘要

### 核心目标

**让用户用起来、本地稳固正常跑**

当前产品核心链路已通（分析→报告→导出），但缺少让用户真正用起来的关键环节：
- ❌ 用户看不到结构化洞察（只有一堆文字）
- ❌ 无法验证证据真实性（缺少原帖链接）
- ❌ 运营无法监控质量（盲飞状态）
- ❌ API 缺少严格类型（前后端不一致）
- ❌ 本地验收流程不标准（每次手动检查）

### 解决方案

通过 6 个 User Story（4 个 P0 + 2 个 P1）补全产品闭环：

1. **洞察卡片展示与证据验证**（P0）- 用户能看到结构化洞察并验证证据
2. **质量看板实时监控**（P0）- 运营能看到实时质量指标
3. **API 契约强制执行**（P0）- 所有 API 有严格类型，CI 自动检测 breaking changes
4. **本地验收流程标准化**（P0）- 一键启动所有服务，自动验收核心功能
5. **阈值校准与数据质量提升**（P1）- Precision@50 ≥ 0.6
6. **实体词典 v0 与报告行动位**（P1）- 识别 50 个核心实体，报告有行动建议

---

## 📊 计划概览

### 时间线

| 阶段 | 时间 | User Stories | 验收标准 |
|------|------|-------------|---------|
| Week 1 | Day 1-5 | US1-US4 (P0) | 本地验收测试通过 |
| Week 2 | Day 6-10 | US5-US6 (P1) | Precision@50 ≥ 0.6 |

### 任务统计

- **总任务数**: 81
- **Phase 1 (Setup)**: 5 个任务
- **Phase 2 (Foundational)**: 4 个任务
- **Phase 3-8 (User Stories)**: 66 个任务
- **Phase 9 (Polish)**: 6 个任务

### 新增文件统计

- **后端**: 13 个新文件（API、Service、Schema、Script、Test）
- **前端**: 12 个新文件（Page、Component、API、Type）
- **配置**: 2 个新文件（entity_dictionary.yaml、标注模板）
- **文档**: 5 个新文件（Spec、Plan、Tasks、README、QUICKSTART）

---

## 🎯 User Stories 详解

### US1: 洞察卡片展示与证据验证 (P0)

**目标**: 用户能看到结构化洞察卡片并点击查看证据

**关键交付物**:
- 后端 API: `GET /api/insights/{task_id}`
- 前端页面: `/insights/{taskId}`
- 组件: InsightCard, EvidenceList

**验收标准**:
- [ ] 洞察卡片列表正常展示（标题、摘要、置信度）
- [ ] 点击卡片能展开查看证据段落
- [ ] 证据包含原帖链接、摘录、时间、子版块
- [ ] 点击原帖链接能在新标签页打开 Reddit

**预计时间**: 2 天（Day 1-2）

---

### US2: 质量看板实时监控 (P0)

**目标**: 运营能看到实时质量指标

**关键交付物**:
- 后端 API: `GET /api/metrics/daily`
- 前端页面: `/dashboard`
- 组件: MetricsChart（使用 recharts）

**验收标准**:
- [ ] 质量看板展示缓存命中率、重复率、处理耗时
- [ ] 趋势图正常渲染
- [ ] 选择日期范围后 5 秒内刷新
- [ ] 指标异常时高亮显示警告

**预计时间**: 1 天（Day 3）

---

### US3: API 契约强制执行 (P0)

**目标**: 所有 API 有严格类型，CI 自动检测 breaking changes

**关键交付物**:
- 所有 API 端点启用 `response_model`
- CI 集成 `make test-contract`
- OpenAPI schema 更新

**验收标准**:
- [ ] 所有 API 端点有明确的响应类型
- [ ] 访问 `/api/openapi.json` 返回完整文档
- [ ] CI 中自动运行契约测试
- [ ] 修改 API 字段后 CI 失败并提示 breaking change

**预计时间**: 1 天（Day 4）

---

### US4: 本地验收流程标准化 (P0)

**目标**: 一键启动所有服务，自动验收核心功能

**关键交付物**:
- 验收脚本: `backend/scripts/local_acceptance.py`
- Makefile 命令: `make local-acceptance`
- 验收报告目录: `reports/local-acceptance/`

**验收标准**:
- [ ] 运行 `make dev-golden-path` 所有服务启动成功
- [ ] 运行 `make local-acceptance` 所有测试通过
- [ ] 生成验收报告到 `reports/local-acceptance/`

**预计时间**: 1 天（Day 5）

---

### US5: 阈值校准与数据质量提升 (P1)

**目标**: Precision@50 ≥ 0.6

**关键交付物**:
- 人工标注数据: `data/annotations/sample_200.csv`
- 校准脚本: `backend/scripts/calibrate_threshold.py`
- 阈值配置: `backend/config/scoring_rules.yaml`

**验收标准**:
- [ ] 完成 200 条帖子人工标注
- [ ] Precision@50 ≥ 0.6
- [ ] 最优阈值写入配置
- [ ] 生成校准报告到 `reports/threshold-calibration/`

**预计时间**: 2 天（Day 6-7）

---

### US6: 实体词典 v0 与报告行动位 (P1)

**目标**: 报告中能识别 50 个核心实体，行动位字段完整展示

**关键交付物**:
- 实体词典: `backend/config/entity_dictionary.yaml`（50 个核心词）
- 实体匹配服务: `backend/app/services/analysis/entity_matcher.py`
- 报告行动位: `action_items` 字段（问题定义、建议动作、置信度、优先级）
- 前端组件: ActionItems.tsx

**验收标准**:
- [ ] 手写 50 个核心实体词（品牌、功能、痛点）
- [ ] 报告中能识别实体
- [ ] 报告新增行动位字段
- [ ] 前端高亮显示实体和行动建议

**预计时间**: 2 天（Day 8-10）

---

## 📁 文档结构

所有文档位于 `.specify/specs/007-mvp-product-loop/`：

```
.specify/specs/007-mvp-product-loop/
├── README.md                    # 项目概览（快速导航）
├── spec.md                      # 功能规格（User Stories + 验收标准）
├── plan.md                      # 实施计划（技术方案 + 时间表）
├── tasks.md                     # 任务清单（81 个可执行任务）
├── QUICKSTART.md                # 快速开始（执行指南）
└── acceptance-template.md       # 验收报告模板
```

---

## 🚀 快速开始

### 1. 查看完整计划

```bash
cd .specify/specs/007-mvp-product-loop

# 查看项目概览
cat README.md

# 查看功能规格
cat spec.md

# 查看实施计划
cat plan.md

# 查看任务清单
cat tasks.md

# 查看快速开始指南
cat QUICKSTART.md
```

### 2. 创建工作分支

```bash
git checkout -b 007-mvp-product-loop
```

### 3. 开始执行

按照 `tasks.md` 的 Phase 顺序执行：

```bash
# Phase 1: Setup（5 个任务）
mkdir -p data/annotations reports/local-acceptance reports/threshold-calibration

# Phase 2: Foundational（4 个任务）
cd backend
make db-migrate MESSAGE="add action items to analysis"
cd ../frontend
npm install recharts

# Phase 3-8: 按 tasks.md 执行
# ...
```

### 4. 每日检查

- [ ] 每天开始前：拉取最新代码、查看今日任务、启动服务
- [ ] 每天结束前：运行测试、代码格式化、类型检查、提交代码、更新进度

---

## ✅ 验收标准

### Week 1 验收（P0）

- [ ] 用户能在报告页面看到洞察卡片列表
- [ ] 点击卡片可展开查看证据段落
- [ ] 每条证据都有原帖链接和时间戳
- [ ] 运营能在质量看板查看实时指标
- [ ] 质量看板 5 秒内刷新趋势图
- [ ] CI 中自动检测 API breaking changes
- [ ] 运行 `make local-acceptance` 所有测试通过

### Week 2 验收（P1）

- [ ] Precision@50 ≥ 0.6
- [ ] 报告中能识别 50 个核心实体
- [ ] 报告新增行动位字段（问题定义、建议动作、置信度、优先级）
- [ ] 前端高亮显示实体和行动建议

### 最终验收（2 周后）

- [ ] 运行 `make dev-golden-path` 所有服务启动成功
- [ ] 运行 `make local-acceptance` 所有测试通过
- [ ] 生成验收报告到 `reports/local-acceptance/final.md`
- [ ] 产品经理能独立使用产品（注册 → 分析 → 查看洞察 → 导出）

---

## 📊 成功指标

### 产品可用性

- **洞察卡片浏览时间**: < 2 分钟
- **质量看板刷新时间**: < 5 秒
- **本地验收测试时间**: < 3 分钟

### 数据质量

- **Precision@50**: ≥ 0.6
- **实体识别数量**: ≥ 50 个核心词
- **行动位完整性**: 100%（问题定义、建议动作、置信度、优先级）

### 技术质量

- **API 契约覆盖率**: 100%（所有端点有 `response_model`）
- **测试覆盖率**: ≥ 80%
- **代码格式化**: 100%（black + isort + prettier）
- **类型检查**: 0 错误（mypy --strict + tsc）

---

## 🚨 风险与应对

### 风险 1: 人工标注耗时超预期

**影响**: US5 阈值校准延期

**应对**:
- 降低标注数量：200 → 100
- 简化标注维度：强/中/弱 → 机会/非机会
- 延后到 Week 3（不阻塞 P0 功能）

### 风险 2: 前端图表渲染性能问题

**影响**: US2 质量看板刷新慢

**应对**:
- 限制数据点数量：最多 100 个点
- 使用虚拟滚动
- 延迟加载历史数据

### 风险 3: API 契约化改动范围大

**影响**: US3 API 契约化延期

**应对**:
- 优先修复核心端点（insights、metrics、reports）
- 其他端点延后到 Week 3
- 分批提交，避免大规模冲突

---

## 📝 下一步计划

### Week 3（如果需要）

- [ ] 补充 E2E 测试（Playwright）
- [ ] 性能优化（API 响应时间、前端渲染）
- [ ] 文档完善（API 文档、用户手册）

### Month 2（长期规划）

- [ ] NER v1（实体抽取）
- [ ] 趋势分析（新兴主题、增长率）
- [ ] 竞品雷达（品牌对比可视化）
- [ ] PPT/Notion 导出

---

## 📞 联系方式

- **Spec 负责人**: [待填写]
- **技术负责人**: [待填写]
- **产品负责人**: [待填写]

---

## 📚 相关文档

- **PRD**: `docs/PRD/PRD-INDEX.md`
- **架构**: `docs/PRD/ARCHITECTURE.md`
- **API 参考**: `docs/API-REFERENCE.md`
- **本地运行**: `docs/handbook/本地运行验收执行方案-2025-10-07.md`
- **质量标准**: `docs/2025-10-10-质量标准与门禁规范.md`

---

**最后更新**: 2025-10-27  
**下次检查**: Week 1 结束（2025-11-03）

---

## 🎉 总结

这是一个**完整、可执行、结构化**的 MVP 产品闭环补全计划：

✅ **6 个 User Stories**（4 个 P0 + 2 个 P1）  
✅ **81 个可执行任务**（精确到文件路径）  
✅ **2 周时间线**（Week 1: P0, Week 2: P1）  
✅ **清晰的验收标准**（每个 User Story 独立可测试）  
✅ **完整的文档**（Spec、Plan、Tasks、README、QUICKSTART）  
✅ **风险应对方案**（3 个主要风险 + 应对措施）

**现在就开始执行吧！** 🚀

