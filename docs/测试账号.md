# Reddit Signal Scanner - 测试账号

**用途**: 本地开发、验收测试、演示展示

---

## 📋 测试账号列表

| 邮箱 | 密码 | 角色 | 说明 |
|------|------|------|------|
| `admin@test.com` | `Admin123!` | 管理员 | 拥有管理员权限，可以访问所有功能 |
| `user1@test.com` | `User123!` | 普通用户 | 普通用户账号 #1 |
| `user2@test.com` | `User123!` | 普通用户 | 普通用户账号 #2 |
| `demo@test.com` | `Demo123!` | 演示账号 | 用于演示展示 |
| `test@test.com` | `Test123!` | 测试账号 | 用于自动化测试 |

---

## 🔐 账号特性

### 管理员账号 (`admin@test.com`)

- **权限**: 完整的管理员权限
- **功能**:
  - 访问 Admin 后台 (`/admin`)
  - 管理社区池 (Community Pool)
  - 查看所有用户的任务和报告
  - 审核待处理社区 (Pending Communities)
  - 查看系统统计数据
- **白名单**: 已添加到 `ADMIN_EMAILS` 环境变量

### 普通用户账号 (`user1@test.com`, `user2@test.com`)

- **权限**: 标准用户权限
- **功能**:
  - 创建分析任务
  - 查看自己的任务和报告
  - 提交 Beta 反馈
  - 上报缺失社区

### 演示账号 (`demo@test.com`)

- **用途**: 用于演示和展示
- **建议**: 在演示前预先创建一些示例任务和报告

### 测试账号 (`test@test.com`)

- **用途**: 用于自动化测试和集成测试
- **建议**: 不要在生产环境使用

---

## 🚀 创建测试账号

### 方式一：使用启动脚本（自动创建）

启动脚本会自动创建所有测试账号：

```bash
./scripts/start-local.sh
```

### 方式二：手动创建

```bash
# 进入后端目录
cd backend

# 加载环境变量
export $(cat .env | grep -v '^#' | xargs)

# 创建测试账号
python scripts/seed_test_accounts.py
```

### 方式三：重置密码

如果忘记密码或需要重置：

```bash
cd backend
export $(cat .env | grep -v '^#' | xargs)
python scripts/seed_test_accounts.py --reset
```

---

## 🧪 测试登录

### 使用 API 文档测试

1. 打开 API 文档: http://localhost:8006/docs
2. 找到 `POST /api/auth/login` 端点
3. 点击 "Try it out"
4. 输入测试账号信息：
   ```json
   {
     "email": "admin@test.com",
     "password": "Admin123!"
   }
   ```
5. 点击 "Execute"
6. 复制返回的 `access_token`

### 使用 curl 测试

```bash
# 登录获取 token
curl -X POST "http://localhost:8006/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@test.com",
    "password": "Admin123!"
  }'

# 期望返回：
# {
#   "access_token": "eyJ...",
#   "token_type": "bearer",
#   "user": {
#     "id": "11111111-1111-1111-1111-111111111111",
#     "email": "admin@test.com"
#   }
# }
```

### 使用前端测试

1. 打开前端首页: http://localhost:3006/
2. 点击登录按钮
3. 输入测试账号信息
4. 点击登录

---

## 🔍 验证账号权限

### 验证管理员权限

```bash
# 登录获取 token
TOKEN=$(curl -s -X POST "http://localhost:8006/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@test.com","password":"Admin123!"}' \
  | jq -r '.access_token')

# 访问管理员端点
curl -X GET "http://localhost:8006/api/admin/community-pool" \
  -H "Authorization: Bearer $TOKEN"

# 期望返回：社区池列表（200 OK）
```

### 验证普通用户权限

```bash
# 登录获取 token
TOKEN=$(curl -s -X POST "http://localhost:8006/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"email":"user1@test.com","password":"User123!"}' \
  | jq -r '.access_token')

# 尝试访问管理员端点
curl -X GET "http://localhost:8006/api/admin/community-pool" \
  -H "Authorization: Bearer $TOKEN"

# 期望返回：403 Forbidden
```

---

## 📊 查看账号信息

### 使用数据库查询

```bash
# 连接到数据库
psql -d reddit_scanner

# 查看所有测试账号
SELECT id, email, is_active, created_at 
FROM users 
WHERE email LIKE '%@test.com' 
ORDER BY email;

# 期望输出：
#                   id                  |      email       | is_active |         created_at         
# --------------------------------------+------------------+-----------+----------------------------
#  11111111-1111-1111-1111-111111111111 | admin@test.com   | t         | 2025-10-16 14:45:00.123456
#  44444444-4444-4444-4444-444444444444 | demo@test.com    | t         | 2025-10-16 14:45:00.234567
#  55555555-5555-5555-5555-555555555555 | test@test.com    | t         | 2025-10-16 14:45:00.345678
#  22222222-2222-2222-2222-222222222222 | user1@test.com   | t         | 2025-10-16 14:45:00.456789
#  33333333-3333-3333-3333-333333333333 | user2@test.com   | t         | 2025-10-16 14:45:00.567890
```

---

## 🛡️ 安全注意事项

### 本地开发环境

- ✅ 可以使用这些测试账号
- ✅ 密码简单易记，方便开发

### 生产环境

- ❌ **绝对不要**使用这些测试账号
- ❌ **绝对不要**使用这些简单密码
- ✅ 使用强密码和真实邮箱
- ✅ 启用双因素认证（如果支持）

---

## 🔄 重置测试数据

如果需要清空所有测试数据并重新开始：

```bash
# 停止所有服务
./scripts/stop-local.sh

# 重置数据库
cd backend
export $(cat .env | grep -v '^#' | xargs)
alembic downgrade base
alembic upgrade head

# 重新创建测试账号
python scripts/seed_test_accounts.py

# 重新启动服务
cd ..
./scripts/start-local.sh
```

---

## 📝 常见问题

### Q: 登录时提示 "Invalid credentials"

**A**: 检查以下几点：
1. 邮箱和密码是否正确（区分大小写）
2. 测试账号是否已创建（运行 `python scripts/seed_test_accounts.py`）
3. 数据库是否正常运行（`pg_isready`）

### Q: 如何添加新的测试账号？

**A**: 编辑 `backend/scripts/seed_test_accounts.py`，在 `TEST_ACCOUNTS` 列表中添加新账号，然后运行脚本。

### Q: 如何修改测试账号的密码？

**A**: 
1. 编辑 `backend/scripts/seed_test_accounts.py`，修改对应账号的密码
2. 运行 `python scripts/seed_test_accounts.py --reset`

### Q: 管理员账号没有管理员权限？

**A**: 检查 `backend/.env` 文件中的 `ADMIN_EMAILS` 是否包含 `admin@test.com`：
```bash
cat backend/.env | grep ADMIN_EMAILS
# 应该输出: ADMIN_EMAILS=prd-test@example.com,admin@test.com
```

---

## 🎯 快速参考

**最常用的测试账号**:
- 管理员: `admin@test.com` / `Admin123!`
- 普通用户: `user1@test.com` / `User123!`

**创建账号**: `python backend/scripts/seed_test_accounts.py`

**重置密码**: `python backend/scripts/seed_test_accounts.py --reset`

**登录测试**: http://localhost:8006/docs → `POST /api/auth/login`

---

**准备好了吗？现在就用这些测试账号登录验收吧！** 🚀

