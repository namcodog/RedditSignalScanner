# Reddit Signal Scanner - è´¨é‡æ ‡å‡†ä¸é—¨ç¦è§„èŒƒ

> **åˆ›å»ºæ—¥æœŸ**: 2025-10-10
> **ç›®æ ‡**: ç¡®ä¿ä»£ç è´¨é‡ä»ç¬¬ä¸€å¤©å¼€å§‹å°±è¾¾åˆ°ç”Ÿäº§æ ‡å‡†
> **åŸåˆ™**: "è´¨é‡å†…å»ºï¼Œè€Œéäº‹åæ£€æŸ¥"

---

## ğŸ¯ è´¨é‡æ‰¿è¯º

### é›¶å®¹å¿åŸåˆ™

1. **âŒ ç±»å‹é”™è¯¯**: mypy --strictå¿…é¡»0é”™è¯¯
2. **âŒ æµ‹è¯•å¤±è´¥**: pytestå¿…é¡»100%é€šè¿‡
3. **âŒ ç±»å‹é€ƒé€¸**: ç¦æ­¢`# type: ignore`, `Any`, `Dict[str, Any]`
4. **âŒ æ ¼å¼æ··ä¹±**: black + isortå¿…é¡»é€šè¿‡
5. **âŒ å®‰å…¨æ¼æ´**: ç¦æ­¢ç¡¬ç¼–ç å¯†ç ã€SQLæ³¨å…¥ç­‰

---

## ğŸ“‹ è´¨é‡é—¨ç¦ (Quality Gates)

### Level 1: æœ¬åœ°å¼€å‘é—¨ç¦ï¼ˆæ¯æ¬¡ä¿å­˜ï¼‰

**è‡ªåŠ¨æ‰§è¡Œ**ï¼ˆIDEé…ç½®ï¼‰:
```json
// .vscode/settings.json
{
  "python.linting.mypyEnabled": true,
  "python.linting.mypyArgs": ["--strict"],
  "editor.formatOnSave": true,
  "python.formatting.provider": "black",
  "[python]": {
    "editor.codeActionsOnSave": {
      "source.organizeImports": true
    }
  }
}
```

**æ£€æŸ¥é¡¹**:
- [ ] MyPyå®æ—¶æ£€æŸ¥
- [ ] Blackè‡ªåŠ¨æ ¼å¼åŒ–
- [ ] isortè‡ªåŠ¨æ•´ç†å¯¼å…¥

### Level 2: æäº¤å‰é—¨ç¦ï¼ˆgit commitï¼‰

**pre-commit hook** (`.pre-commit-config.yaml`):
```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files

  - repo: https://github.com/psf/black
    rev: 23.7.0
    hooks:
      - id: black

  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.7.0
    hooks:
      - id: mypy
        args: [--strict, --config-file=mypy.ini]
        additional_dependencies: [types-all]

  - repo: local
    hooks:
      - id: pytest-check
        name: pytest-check
        entry: pytest
        language: system
        pass_filenames: false
        always_run: true
```

**å®‰è£…**:
```bash
pip install pre-commit
pre-commit install
```

**æ£€æŸ¥é¡¹**:
- [ ] Blackæ ¼å¼åŒ–
- [ ] isortå¯¼å…¥æ’åº
- [ ] MyPyç±»å‹æ£€æŸ¥
- [ ] pytestå¿«é€Ÿæµ‹è¯•ï¼ˆå…³é”®æ¨¡å—ï¼‰

### Level 3: PRé—¨ç¦ï¼ˆä»£ç è¯„å®¡ï¼‰

**è‡ªåŠ¨CIæ£€æŸ¥** (`.github/workflows/quality.yml`):
```yaml
name: Quality Gate

on: [pull_request]

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt

      - name: MyPyç±»å‹æ£€æŸ¥
        run: |
          mypy --strict backend/app backend/tests

      - name: pytestæµ‹è¯•
        run: |
          pytest backend/tests --cov=backend.app --cov-report=xml

      - name: ä¸Šä¼ è¦†ç›–ç‡
        uses: codecov/codecov-action@v3
        with:
          files: ./coverage.xml

      - name: Blackæ ¼å¼æ£€æŸ¥
        run: |
          black backend/app --check

      - name: isortæ£€æŸ¥
        run: |
          isort backend/app --check
```

**äººå·¥Reviewæ£€æŸ¥æ¸…å•**:
- [ ] ä»£ç ç¬¦åˆPRDè®¾è®¡
- [ ] å‘½åæ¸…æ™°æœ‰æ„ä¹‰
- [ ] æ²¡æœ‰è¿‡åº¦å¤æ‚çš„é€»è¾‘
- [ ] æµ‹è¯•è¦†ç›–å……åˆ†
- [ ] æ–‡æ¡£åŒæ­¥æ›´æ–°

### Level 4: å‘å¸ƒé—¨ç¦ï¼ˆéƒ¨ç½²å‰ï¼‰

**å®Œæ•´éªŒæ”¶**:
```bash
#!/bin/bash
# scripts/release_gate.sh

echo "===== å‘å¸ƒè´¨é‡é—¨ç¦ ====="

# 1. å®Œæ•´ç±»å‹æ£€æŸ¥
echo "\n[1/6] å®Œæ•´ç±»å‹æ£€æŸ¥..."
mypy --strict backend/app backend/tests frontend/src
if [ $? -ne 0 ]; then
    echo "âŒ ç±»å‹æ£€æŸ¥å¤±è´¥"
    exit 1
fi

# 2. å®Œæ•´æµ‹è¯•å¥—ä»¶
echo "\n[2/6] å®Œæ•´æµ‹è¯•å¥—ä»¶..."
pytest backend/tests tests/ --cov=backend.app --cov-report=term-missing --cov-fail-under=80
if [ $? -ne 0 ]; then
    echo "âŒ æµ‹è¯•å¤±è´¥æˆ–è¦†ç›–ç‡ä¸è¶³80%"
    exit 1
fi

# 3. ç«¯åˆ°ç«¯æµ‹è¯•
echo "\n[3/6] ç«¯åˆ°ç«¯æµ‹è¯•..."
pytest tests/integration/test_e2e_flow.py -v
if [ $? -ne 0 ]; then
    echo "âŒ E2Eæµ‹è¯•å¤±è´¥"
    exit 1
fi

# 4. æ€§èƒ½æµ‹è¯•
echo "\n[4/6] æ€§èƒ½æµ‹è¯•..."
pytest tests/performance/ -v
if [ $? -ne 0 ]; then
    echo "âŒ æ€§èƒ½æµ‹è¯•å¤±è´¥"
    exit 1
fi

# 5. å®‰å…¨æ‰«æ
echo "\n[5/6] å®‰å…¨æ‰«æ..."
bandit -r backend/app -ll
if [ $? -ne 0 ]; then
    echo "âš ï¸ å‘ç°å®‰å…¨é—®é¢˜"
fi

# 6. ä¾èµ–æ£€æŸ¥
echo "\n[6/6] ä¾èµ–æ¼æ´æ£€æŸ¥..."
pip-audit
if [ $? -ne 0 ]; then
    echo "âš ï¸ å‘ç°ä¾èµ–æ¼æ´"
fi

echo "\nâœ… æ‰€æœ‰é—¨ç¦æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥å‘å¸ƒï¼"
```

---

## ğŸ” ä»£ç è´¨é‡æ ‡å‡†

### 1. ç±»å‹å®‰å…¨æ ‡å‡†

#### å¿…é¡»éµå®ˆ

```python
# âœ… æ­£ç¡®ï¼šå®Œæ•´ç±»å‹æ³¨è§£
from typing import Dict, List, Optional
from pydantic import BaseModel

class UserRequest(BaseModel):
    email: str
    password: str

async def create_user(
    request: UserRequest,
    db: AsyncSession
) -> Dict[str, str]:
    user = User(email=request.email)
    db.add(user)
    await db.commit()
    return {"user_id": str(user.id)}

# âœ… æ­£ç¡®ï¼šå¯é€‰å‚æ•°
def process_data(
    data: List[str],
    limit: Optional[int] = None
) -> Dict[str, int]:
    ...
```

#### ç»å¯¹ç¦æ­¢

```python
# âŒ é”™è¯¯ï¼šç¼ºå°‘ç±»å‹æ³¨è§£
def process_data(data):
    ...

# âŒ é”™è¯¯ï¼šä½¿ç”¨Any
from typing import Any
def process_data(data: Any) -> Any:
    ...

# âŒ é”™è¯¯ï¼šä½¿ç”¨Dict[str, Any]
def process_data() -> Dict[str, Any]:
    ...

# âŒ é”™è¯¯ï¼štype: ignore
result = dangerous_function()  # type: ignore
```

#### MyPyé…ç½®

```ini
# mypy.ini
[mypy]
python_version = 3.11
strict = True
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = True
disallow_any_unimported = True
disallow_any_expr = True
disallow_any_decorated = True
disallow_any_explicit = True
disallow_any_generics = True
disallow_subclassing_any = True
```

### 2. æµ‹è¯•è´¨é‡æ ‡å‡†

#### è¦†ç›–ç‡è¦æ±‚

| ç±»å‹ | æœ€ä½è¦†ç›–ç‡ | ç›®æ ‡è¦†ç›–ç‡ |
|------|----------|----------|
| å•å…ƒæµ‹è¯• | 70% | 80%+ |
| é›†æˆæµ‹è¯• | 60% | 70%+ |
| ç«¯åˆ°ç«¯æµ‹è¯• | å…³é”®è·¯å¾„100% | æ‰€æœ‰æµç¨‹ |

#### æµ‹è¯•å‘½åè§„èŒƒ

```python
# âœ… æ­£ç¡®ï¼šæ¸…æ™°çš„æµ‹è¯•åç§°
def test_create_user_with_valid_email_succeeds():
    """æµ‹è¯•ä½¿ç”¨æœ‰æ•ˆé‚®ç®±åˆ›å»ºç”¨æˆ·æˆåŠŸ"""
    ...

def test_create_user_with_duplicate_email_raises_conflict():
    """æµ‹è¯•ä½¿ç”¨é‡å¤é‚®ç®±åˆ›å»ºç”¨æˆ·è¿”å›å†²çªé”™è¯¯"""
    ...

# âŒ é”™è¯¯ï¼šæ¨¡ç³Šçš„æµ‹è¯•åç§°
def test_user():
    ...

def test_case_1():
    ...
```

#### æµ‹è¯•ç»“æ„ï¼ˆAAAæ¨¡å¼ï¼‰

```python
def test_analyze_task_creates_task_and_returns_id():
    # Arrange (å‡†å¤‡)
    request = AnalyzeRequest(product_description="Test product")

    # Act (æ‰§è¡Œ)
    response = client.post("/api/analyze", json=request.dict())

    # Assert (æ–­è¨€)
    assert response.status_code == 201
    assert "task_id" in response.json()
    assert UUID(response.json()["task_id"])  # éªŒè¯æ˜¯æœ‰æ•ˆUUID
```

### 3. ä»£ç æ ¼å¼æ ‡å‡†

#### Blacké…ç½®

```toml
# pyproject.toml
[tool.black]
line-length = 88
target-version = ['py311']
include = '\.pyi?$'
```

#### isorté…ç½®

```toml
# pyproject.toml
[tool.isort]
profile = "black"
multi_line_output = 3
include_trailing_comma = true
force_grid_wrap = 0
use_parentheses = true
ensure_newline_before_comments = true
line_length = 88
```

#### è¡Œé•¿åº¦

- Python: 88å­—ç¬¦ï¼ˆBlacké»˜è®¤ï¼‰
- TypeScript/JavaScript: 80å­—ç¬¦
- SQL: 100å­—ç¬¦

### 4. å‘½åè§„èŒƒ

#### Python

```python
# æ¨¡å—/åŒ…: snake_case
import user_service
from backend.app.models import user_model

# ç±»: PascalCase
class UserService:
    pass

class AnalysisEngine:
    pass

# å‡½æ•°/å˜é‡: snake_case
def create_user(email: str) -> User:
    user_id = generate_uuid()
    ...

# å¸¸é‡: UPPER_SNAKE_CASE
MAX_RETRY_ATTEMPTS = 3
DEFAULT_TIMEOUT = 30

# ç§æœ‰æˆå‘˜: _leading_underscore
class MyClass:
    def __init__(self):
        self._private_var = 10

    def _private_method(self):
        pass
```

#### TypeScript

```typescript
// æ¥å£/ç±»å‹: PascalCase
interface UserResponse {
  userId: string;
  email: string;
}

// ç±»: PascalCase
class ApiClient {
  ...
}

// å‡½æ•°/å˜é‡: camelCase
function createUser(email: string): Promise<User> {
  const userId = generateUuid();
  ...
}

// å¸¸é‡: UPPER_SNAKE_CASE
const MAX_RETRY_ATTEMPTS = 3;

// Reactç»„ä»¶: PascalCase
export function InputPage() {
  ...
}
```

### 5. æ–‡æ¡£æ ‡å‡†

#### Python Docstringï¼ˆGoogleé£æ ¼ï¼‰

```python
def analyze_product(
    product_description: str,
    max_communities: int = 20
) -> Dict[str, Any]:
    """åˆ†æäº§å“æè¿°å¹¶ç”Ÿæˆæ´å¯ŸæŠ¥å‘Š.

    Args:
        product_description: äº§å“æè¿°æ–‡æœ¬ï¼Œè‡³å°‘10ä¸ªå­—ç¬¦
        max_communities: åˆ†æçš„æœ€å¤§ç¤¾åŒºæ•°é‡ï¼Œé»˜è®¤20

    Returns:
        åŒ…å«åˆ†æç»“æœçš„å­—å…¸ï¼Œæ ¼å¼ï¼š
        {
            'insights': {...},
            'sources': {...},
            'confidence_score': 0.85
        }

    Raises:
        ValueError: å¦‚æœproduct_descriptionå¤ªçŸ­
        RedditAPIException: å¦‚æœReddit APIè°ƒç”¨å¤±è´¥

    Example:
        >>> result = analyze_product("AI note-taking app")
        >>> result['confidence_score']
        0.85
    """
    ...
```

#### TypeScript JSDoc

```typescript
/**
 * åˆ›å»ºåˆ†æä»»åŠ¡
 *
 * @param description - äº§å“æè¿°ï¼Œ10-2000å­—ç¬¦
 * @returns PromiseåŒ…å«ä»»åŠ¡IDå’ŒSSEç«¯ç‚¹
 * @throws {ApiError} å¦‚æœè¯·æ±‚å¤±è´¥
 *
 * @example
 * ```ts
 * const result = await createAnalysisTask("AI app");
 * console.log(result.taskId);
 * ```
 */
async function createAnalysisTask(
  description: string
): Promise<AnalyzeResponse> {
  ...
}
```

---

## ğŸ“Š è´¨é‡æŒ‡æ ‡è¿½è¸ª

### æ¯å‘¨è´¨é‡æŠ¥å‘Šæ¨¡æ¿

```markdown
## è´¨é‡å‘¨æŠ¥ (Week X, YYYY-MM-DD)

### ç±»å‹å®‰å…¨
- MyPyé”™è¯¯æ•°: Xä¸ªï¼ˆç›®æ ‡:0ï¼‰
- è¶‹åŠ¿: â†‘/â†“/â†’

### æµ‹è¯•è¦†ç›–ç‡
- å•å…ƒæµ‹è¯•: X% (ç›®æ ‡: >80%)
- é›†æˆæµ‹è¯•: X% (ç›®æ ‡: >70%)
- E2Eæµ‹è¯•: X% (ç›®æ ‡: å…³é”®è·¯å¾„100%)

### ä»£ç è´¨é‡
- æ–°å¢ä»£ç è¡Œæ•°: Xè¡Œ
- æ–°å¢æµ‹è¯•è¡Œæ•°: Xè¡Œ
- æµ‹è¯•/ä»£ç æ¯”: X%

### Bugç»Ÿè®¡
- æ–°å‘ç°bug: Xä¸ª
- å·²ä¿®å¤bug: Xä¸ª
- å¾…ä¿®å¤bug: Xä¸ª

### æ€§èƒ½æŒ‡æ ‡
- APIå“åº”æ—¶é—´ (P95): Xms (ç›®æ ‡: <200ms)
- åˆ†æå®Œæˆæ—¶é—´ (P95): Xs (ç›®æ ‡: <300s)

### æŠ€æœ¯å€ºåŠ¡
- TODOæ•°é‡: Xä¸ª
- FIXMEæ•°é‡: Xä¸ª
```

### è´¨é‡è¶‹åŠ¿å›¾è¡¨

ä½¿ç”¨å·¥å…·ï¼š
- **Coverage.py**: æµ‹è¯•è¦†ç›–ç‡
- **MyPy**: ç±»å‹é”™è¯¯è¶‹åŠ¿
- **pytest-benchmark**: æ€§èƒ½åŸºå‡†
- **SonarQube**: ä»£ç è´¨é‡ç»¼åˆè¯„åˆ†

---

## ğŸš¨ è´¨é‡é—®é¢˜å‡çº§æœºåˆ¶

### é—®é¢˜çº§åˆ«

| çº§åˆ« | å®šä¹‰ | å“åº”æ—¶é—´ | å¤„ç†æ–¹å¼ |
|------|------|---------|---------|
| P0-ç´§æ€¥ | ç±»å‹æ£€æŸ¥å¤±è´¥ã€æµ‹è¯•å…¨çº¢ | ç«‹å³ | é˜»æ­¢æ‰€æœ‰å¼€å‘ï¼Œå…¨å‘˜ä¿®å¤ |
| P1-ä¸¥é‡ | è¦†ç›–ç‡<60%ã€æ€§èƒ½ä¸‹é™>20% | 4å°æ—¶ | æš‚åœæ–°åŠŸèƒ½ï¼Œä¼˜å…ˆä¿®å¤ |
| P2-é‡è¦ | å•ä¸ªæ¨¡å—è¦†ç›–ç‡<70% | 1å¤© | çº³å…¥å½“å‰Sprint |
| P3-ä¸€èˆ¬ | ä»£ç æ ¼å¼é—®é¢˜ã€æ–‡æ¡£ç¼ºå¤± | 1å‘¨ | çº³å…¥Backlog |

### å‡çº§æµç¨‹

```
å‘ç°é—®é¢˜ â†’ è¯„çº§ â†’ åˆ›å»ºIssue â†’ åˆ†é…è´£ä»»äºº â†’ ä¿®å¤ â†’ Review â†’ å…³é—­
```

---

## âœ… è´¨é‡æ£€æŸ¥æ¸…å•ï¼ˆæäº¤PRå‰ï¼‰

### ä»£ç checklist

- [ ] æ‰€æœ‰å‡½æ•°éƒ½æœ‰ç±»å‹æ³¨è§£
- [ ] æ²¡æœ‰`# type: ignore`
- [ ] æ²¡æœ‰`Any`ç±»å‹
- [ ] æ²¡æœ‰`Dict[str, Any]`
- [ ] MyPyæ£€æŸ¥é€šè¿‡
- [ ] Blackæ ¼å¼åŒ–é€šè¿‡
- [ ] isortæ’åºé€šè¿‡

### æµ‹è¯•checklist

- [ ] æ–°å¢ä»£ç æœ‰å¯¹åº”æµ‹è¯•
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] è¦†ç›–ç‡æ²¡æœ‰ä¸‹é™
- [ ] æµ‹è¯•åç§°æ¸…æ™°
- [ ] ä½¿ç”¨AAAæ¨¡å¼

### æ–‡æ¡£checklist

- [ ] Docstringå®Œæ•´
- [ ] READMEæ›´æ–°ï¼ˆå¦‚æœ‰APIå˜åŒ–ï¼‰
- [ ] CHANGELOGæ›´æ–°
- [ ] PRDç¬¦åˆåº¦ç¡®è®¤

### æ€§èƒ½checklist

- [ ] æ²¡æœ‰N+1æŸ¥è¯¢
- [ ] æ²¡æœ‰é˜»å¡è°ƒç”¨ï¼ˆåº”ç”¨asyncioï¼‰
- [ ] å¤§æ•°æ®é›†ä½¿ç”¨åˆ†é¡µ
- [ ] åˆç†ä½¿ç”¨ç¼“å­˜

---

## ğŸ“ åŸ¹è®­ä¸æ–‡æ¡£

### æ–°äººOnboarding

Day 1:
1. é˜…è¯»æœ¬è´¨é‡æ ‡å‡†æ–‡æ¡£
2. é…ç½®å¼€å‘ç¯å¢ƒï¼ˆpre-commit hooksï¼‰
3. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

Day 2:
1. ä¿®å¤ä¸€ä¸ª"Good First Issue"
2. ç»å†å®Œæ•´PRæµç¨‹
3. ç†è§£è´¨é‡é—¨ç¦

### æœ€ä½³å®è·µæ–‡æ¡£

- [Pythonç±»å‹æ³¨è§£æœ€ä½³å®è·µ](docs/best-practices/python-typing.md)
- [æµ‹è¯•ç¼–å†™æŒ‡å—](docs/best-practices/testing-guide.md)
- [æ€§èƒ½ä¼˜åŒ–checklist](docs/best-practices/performance.md)

---

## ğŸ“ è”ç³»ä¸æ”¯æŒ

**è´¨é‡é—®é¢˜åé¦ˆ**:
- Slacké¢‘é“: #quality
- é‚®ä»¶: quality@team.com

**å·¥å…·æ”¯æŒ**:
- MyPyé—®é¢˜: [å®˜æ–¹æ–‡æ¡£](https://mypy.readthedocs.io/)
- pytesté—®é¢˜: [å®˜æ–¹æ–‡æ¡£](https://docs.pytest.org/)

---

**è®°ä½**: "è´¨é‡æ˜¯è®¾è®¡å‡ºæ¥çš„ï¼Œä¸æ˜¯æµ‹è¯•å‡ºæ¥çš„ã€‚"

**Let's build it right the first time! ğŸš€**
